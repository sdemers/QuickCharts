<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>QuickCharts</title>
<link rel=stylesheet href="myss.css" type="text/css" />

<script type="text/javascript">

// Gold:   symbol: GOLD, &sid=5486039
// Silver: symbol: SILVER &sid=12067546

var bigChartsServer = "http://bigcharts.marketwatch.com/kaavio.Webhost/charts/big.chart?";

var globChartStyle = "&uf=0&lf=268435456&lf2=4&lf3=2&type=4&size=4&state=11&style=340";
var lastSymbol = "SPX";
var lastCountry = "";

function resetValues()
{
    window.document.form.ma.value              = "8,50";
    //window.document.calcShares.calcComm.value = "10";
    //window.document.calcProfit.calcComm.value = "10";
}

function submitChart(symbolTSX, symbolUS, period, timeframe, MA, mastyle)
{
    if (symbolTSX != '')
    {
        submitBigChartsTSX(symbolTSX, period, timeframe, MA, mastyle)
    }
    else
    {
        submitBigChartsUS(symbolUS, period, timeframe, MA, mastyle)
    }
}

function changeImage(domImg, url)
{
    var img = new Image();
    img.onload = function()
    {
        // Load completed
        domImg.src = url;
    };
    img.src = url;
}

function SelectAll(id)
{
    document.getElementById(id).focus();
    document.getElementById(id).select();
}

function quickSubmit(period, timeframe, MA, mastyle)
{
    var symbol = "symb=" + lastCountry + lastSymbol;

    if (lastSymbol == "GOLD SPOT")
    {
        symbol = "symb=gold&sid=16568881";
    }
    else if (lastSymbol == "SILVER SPOT")
    {
        symbol = "symb=silver&insttype=Future";
    }

    var url = bigChartsServer +
              symbol +
              "&ma=" + mastyle + "&maval=" + MA +
              globChartStyle +
              "&freq=" + period +
              "&time=" + timeframe +
              "&mocktick=1";

    writeChart(url);
}

function submitBigChartsTSX(szSymbol, szPeriod, szTimeFrame, szMA, mastyle)
{
    var url;

    url = bigChartsServer +
          "symb=ca:" + szSymbol +
          "&ma=" + mastyle + "&maval=" + szMA +
          globChartStyle +
          "&freq=" + szPeriod +
          "&time=" + szTimeFrame +
          "&mocktick=1";

    lastSymbol = szSymbol;
    lastCountry = "ca:";

    writeChart(url);
}

function submitBigChartsUS(szSymbol, szPeriod, szTimeFrame, szMA, mastyle)
{
    var url;

    var symbol = "symb=" + szSymbol;

    if (szSymbol == "GOLD SPOT")
    {
        symbol = "symb=gold&sid=16568881";
    }
    else if (szSymbol == "SILVER SPOT")
    {
        symbol = "symb=silver&insttype=Future";
    }

    url = bigChartsServer +
          symbol +
          "&ma=" + mastyle + "&maval=" + szMA +
          globChartStyle +
          "&freq=" + szPeriod +
          "&time=" + szTimeFrame +
          "&mocktick=1";

    lastSymbol = szSymbol;
    lastCountry = "";

    writeChart(url);
}

function writeChart(url)
{
    changeImage(document.getElementById('chartImage'), url);

    var symbol = lastSymbol.replace(/\./, '-');
    if (lastCountry == "ca:")
    {
        symbol += ".to";
    }
    else if (lastCountry == "au:")
    {
        symbol += ".ax";
    }

    var yahooUrl = "https://chart.finance.yahoo.com/t?s=" + symbol + "&lang=en-CA&region=CA&width=220&height=200";
    changeImage(document.getElementById('yahooImage'), yahooUrl);
}

function calcQuantity(cash, commission, price)
{
    var quantity = (cash - commission) / price;

    return Math.floor(quantity);
}

function calcGainLoss(pin, out, price, commission)
{
    var gainLoss = ((out - pin) * price) - (2 * commission);

    return gainLoss.toFixed(2);
}

function generateSel(selList)
{
    var lastIndex = 0;
    var index = selList.indexOf(',');
    var symbol;

    while (index != -1)
    {
        symbol = selList.substring(lastIndex, index);
        lastIndex = index + 1;
        index = selList.indexOf(',', lastIndex);

        document.writeln('<option value="' + symbol + '">' + symbol + '</option>');
    }

    symbol = selList.substring(lastIndex);
    document.writeln('<option value="' + symbol + '">' + symbol + '</option>');
}

function clearField(field)
{
    field.value = '';
}

function adjustTimeframe(newPeriod, currentTimeframe)
{
    var periodTimeframeMappings = [
        {period: "9", timeframe: "1"},
        {period: "6", timeframe: "2"},
        {period: "7", timeframe: "3"},
        {period: "8", timeframe: "18"},
        {period: "1", timeframe: "7"},
        {period: "2", timeframe: "9"} ];

    for (var i = 0; i < periodTimeframeMappings.length; i += 1)
    {
        if (newPeriod == periodTimeframeMappings[i].period)
        {
            return periodTimeframeMappings[i].timeframe;
        }
    }

    return currentTimeframe;
}

</script>

</head>

<body onLoad='return resetValues();'>

<div id="menu">
    <form name="form" onSubmit='return false;'>
    <div id="menu_tsx">
        <div class="padding_top">
            <h3>TSX</h3>
            <input style="font-size:12px;height:14px;" NAME="symbolTSE" TYPE="text" SIZE="8" maxlength="20"
                   onInput="clearField(window.document.form.symbolUS);"
                   onClick="this.setSelectionRange(0, 9999);"/>
        </div>
        <div class="padding_top">
            <select name="selTSX"
            onChange='submitBigChartsTSX(window.document.form.selTSX.value,
                                         window.document.form.period.value,
                                         window.document.form.timeframe.value,
                                         window.document.form.ma.value,
                                         window.document.form.mastyle.value);
                      window.document.form.symbolTSE.value = window.document.form.selTSX.value;
                      clearField(window.document.form.symbolUS);'>

                <script type="text/javascript">
                 var symbolList = 'BBD.B,BCB,DGC,DOL,EFR,ELD,ERF,FR,FVI,G,GIB.A,' +
                                  'GSC,GZM.UN,HED,HVI,HVU,HSU,IMG,ISPTX,IT,IVN,K,MX,' +
                                  'NSU,OTC,PAA,PHX.UN,PLI,QLT,S,SW,SCC,XGD,XRE,ZJG,ZLU';
                    generateSel(symbolList);
                </script>
            </select>
        </div>
    </div>
    <div id="menu_us">
        <div class="padding_top">
            <h3>US</h3>
            <input style="font-size:12px;height:14px;" NAME="symbolUS" TYPE="text" SIZE="8" maxlength="20"
                   onInput="clearField(window.document.form.symbolTSE);"
                   onClick="this.setSelectionRange(0, 9999);"/>
        </div>
        <div class="padding_top">
            <select name="selUS"
             onChange='submitBigChartsUS(window.document.form.selUS.value,
                                         window.document.form.period.value,
                                         window.document.form.timeframe.value,
                                         window.document.form.ma.value,
                                         window.document.form.mastyle.value);
                      window.document.form.symbolUS.value = window.document.form.selUS.value;
                      clearField(window.document.form.symbolTSE);'>

                <script type="text/javascript">
                    var symbolList = 'SPX,COMP,$INDU,SPY,DXY,IWM,C_CAD,HUI,CRUDE OIL,GOLD SPOT,SILVER SPOT,GLD,DGLD,NUGT,DUST,USO,' +
                                     'UWTI,DWTI,DJT,AAPL,ABC,ALX,AMD,AMZN,CARA,CSCO,CHK,' +
                                     'DXPE,EBAY,EROS,FCX,GOOG,HAR,HIG,INTC,LABD,LABU,MCD,MSFT,NBI,NTES,' +
                                     'NVDA,SPXL,SPXS,TDW,TOO,TSLA,UVXY,SVXY,VIX,WMT,YHOO';
                    generateSel(symbolList);
                </script>
            </select>
        </div>
    </div>
    <div id="periodMA">
        <div class="period">
            <h3>Period</h3>
            <select name="period"
             onChange='window.document.form.timeframe.value =
                            adjustTimeframe(window.document.form.period.value,
                                            window.document.form.timeframe.value);
                        quickSubmit(window.document.form.period.value,
                                   window.document.form.timeframe.value,
                                   window.document.form.ma.value,
                                   window.document.form.mastyle.value);'>
                <option value="9">1-Minute</option>
                <option value="6">5-Minute</option>
                <option value="7">15-Minute</option>
                <option value="8">Hourly</option>
                <option value="0" disabled>----------</option>
                <option value="1" selected>Daily</option>
                <option value="2">Weekly</option>
                <option value="3">Monthly</option>
                <option value="4">Quarterly</option>
                <option value="5">Yearly</option>
            </select>
        </div>
        <div id="ma">
            <h3>MA</h3>
            <input style="font-size:12px;height:14px;" NAME="ma" TYPE="text" SIZE="10" maxlength="15" />
        </div>
        <div id="mastyle">
            <input type="radio" name="mastyle" value="1"
                   onChange='quickSubmit(window.document.form.period.value,
                                         window.document.form.timeframe.value,
                                         window.document.form.ma.value,
                                         window.document.form.mastyle.value);'>SMA<br>
            <input type="radio" name="mastyle" value="2" checked
                   onChange='quickSubmit(window.document.form.period.value,
                                         window.document.form.timeframe.value,
                                         window.document.form.ma.value,
                                         window.document.form.mastyle.value);'>EMA<br>
        </div>
        <div class="timeframe">
            <h3>Time frame</h3>
            <select name="timeframe"
                onChange='quickSubmit(window.document.form.period.value,
                                      window.document.form.timeframe.value,
                                      window.document.form.ma.value,
                                      window.document.form.mastyle.value);'>
                <option value="1">1 day</option>
                <option value="2">2 days</option>
                <option value="3">5 days</option>
                <option value="18">10 days</option>
                <option value="0" disabled>----------</option>
                <option value="4">1 month</option>
                <option value="5">2 months</option>
                <option value="6">3 months</option>
                <option value="7" selected>6 months</option>
                <option value="8">1 year</option>
                <option value="9">2 years</option>
                <option value="10">3 years</option>
                <option value="11">4 years</option>
                <option value="12">5 years</option>
                <option value="13">1 decade</option>
                <option value="19">YTD</option>
                <option value="20">All Data</option>
            </select>
        </div>
    </div>
    <div id="submit_buttons">
        <input type="submit" value="Submit"
               onClick='submitChart(window.document.form.symbolTSE.value,
                                    window.document.form.symbolUS.value,
                                    window.document.form.period.value,
                                    window.document.form.timeframe.value,
                                    window.document.form.ma.value,
                                    window.document.form.mastyle.value);' />
    </div>
    </form>

    <div class="submenu">
        <h2><a href="summary.html" target="_blank">Market summary</a></h2>
    </div>

    <!--
    <div class="submenu">
        <a href="industries.html" target="_blank">DJ Industries</a>
    </div>
    -->

    <div class="yahooChart">
        <img id="yahooImage" src="blank.gif" alt="" width="220" height="200" />
    </div>

    <div class="links">
        <h1><a href="http://www.bigcharts.com" target="_blank">Bigcharts</a></h1>
        <h1><a href="http://www.stockcharts.com" target="_blank">Stockcharts</a></h1>
        <h1><a href="http://ca.finance.yahoo.com" target="_blank">Yahoo!</a></h1>
    </div>

    <!--
    <div class="subsection">
        <div class="submenu">
            <h2>Shares calculator</h2>
        </div>
        <div class="calcMain">
            <form name="calcShares"
                onSubmit='window.document.calcShares.calcQty.value =
                          calcQuantity(window.document.calcShares.calcCash.value,
                                       window.document.calcShares.calcComm.value,
                                       window.document.calcShares.calcPrice.value); return false'>

                <div class="calcDesc">Amount $</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcCash" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc">Commission</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcComm" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc">Price / Share</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcPrice" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc"><b>Shares</b></div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcQty" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="padding_top">
                    <input type="submit" value="  OK  "
                     onClick='window.document.calcShares.calcQty.value =
                             calcQuantity(window.document.calcShares.calcCash.value,
                                          window.document.calcShares.calcComm.value,
                                          window.document.calcShares.calcPrice.value); return false;' />
                </div>
            </form>
        </div>
    </div>

    <div class="subsection">
        <div class="submenu">
            <h2>Gain/Loss calculator</h2>
        </div>
        <div class="calcMain">
            <form name="calcProfit"
                onSubmit='window.document.calcProfit.calcGL.value =
                          calcGainLoss(window.document.calcProfit.calcIn.value,
                                       window.document.calcProfit.calcOut.value,
                                       window.document.calcProfit.calcQty.value,
                                       window.document.calcProfit.calcComm.value); return false'>
                <div class="calcDesc">In</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcIn" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc">Out</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcOut" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc">Shares</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcQty" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc">Commission</div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcComm" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="calcDesc"><b>Gain / Loss</b></div>
                <div class="calcField">
                    <input STYLE="font-size:12px;height:14px;" NAME="calcGL" TYPE="text" SIZE="8" maxlength="20" />
                </div>
                <div class="padding_top">
                    <input type="submit" value="  OK  "
                     onClick='window.document.calcProfit.calcGL.value =
                               calcGainLoss(window.document.calcProfit.calcIn.value,
                                            window.document.calcProfit.calcOut.value,
                                            window.document.calcProfit.calcQty.value,
                                            window.document.calcProfit.calcComm.value); return false' />
                </div>
            </form>
        </div>
    </div>
    -->
</div>
<div class="tabs">
     
   <div class="tab">
       <input type="radio" id="tab-1" name="tab-group-1">
       <label for="tab-1">Chart</label>
       
       <div class="content">
           <div id="chart">
				<img id="chartImage" src="blank.gif" alt="" />
			</div>
       </div> 
   </div>
   
   <div class="tab">
      <input type="radio" id="tab-2" name="tab-group-1" checked>
      <label for="tab-2">Yahoo</label>
       
      <div class="content">
          stuff
      </div> 
   </div>   
</div>

</body>
</html>
